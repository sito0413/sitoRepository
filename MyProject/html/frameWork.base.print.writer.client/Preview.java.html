<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ja"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>Preview.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">カバレッジ</a> &gt; <a href="index.source.html" class="el_package">frameWork.base.print.writer.client</a> &gt; <span class="el_source">Preview.java</span></div><h1>Preview.java</h1><pre class="source lang-java linenums">package frameWork.base.print.writer.client;

import java.awt.BorderLayout;
import java.awt.Component;
import java.awt.Dimension;
import java.awt.FlowLayout;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.Insets;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

import javax.swing.JButton;
import javax.swing.JDialog;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JSlider;
import javax.swing.SwingConstants;
import javax.swing.SwingUtilities;
import javax.swing.WindowConstants;
import javax.swing.event.ChangeEvent;
import javax.swing.event.ChangeListener;

import frameWork.base.print.ReportException;
import frameWork.base.print.element.Page;
import frameWork.base.print.writer.Writer;

public class Preview extends JDialog {
	private int pageIndex;
	private final Writer writer;
	
	private JButton previousButton;
	private JButton nextButton;
	private final JPanel centerPanel;
	
	private JLabel label;
	private JLabel lblNewLabel;
	
	public Preview(final Writer writer) {
<span class="nc" id="L42">		super();</span>
<span class="nc" id="L43">		this.pageIndex = 0;</span>
<span class="nc" id="L44">		this.writer = writer;// ビュー生成.</span>
<span class="nc" id="L45">		centerPanel = new JPanel() {</span>
			@Override
			protected void paintComponent(final Graphics g) {
<span class="nc" id="L48">				writer.get(pageIndex).paint((Graphics2D) g);</span>
<span class="nc" id="L49">			}</span>
			
			@Override
			protected void paintChildren(final Graphics g) {
				// NOOP
<span class="nc" id="L54">			}</span>
			
			@Override
			protected void paintBorder(final Graphics g) {
				// NOOP
<span class="nc" id="L59">			}</span>
		};
<span class="nc" id="L61">		initialize();</span>
<span class="nc" id="L62">		setScale(1);</span>
<span class="nc" id="L63">		refreshView();</span>
<span class="nc" id="L64">	}</span>
	
	private void initialize() {
<span class="nc" id="L67">		final JPanel topPanel = new JPanel();</span>
<span class="nc" id="L68">		final FlowLayout flowLayout = new FlowLayout();</span>
<span class="nc" id="L69">		flowLayout.setAlignment(FlowLayout.LEFT);</span>
<span class="nc" id="L70">		flowLayout.setHgap(20);</span>
<span class="nc" id="L71">		flowLayout.setVgap(20);</span>
<span class="nc" id="L72">		final JPanel backGraundPanel = new JPanel();</span>
<span class="nc" id="L73">		backGraundPanel.setLayout(flowLayout);</span>
<span class="nc" id="L74">		backGraundPanel.add(centerPanel, null);</span>
		
<span class="nc" id="L76">		final JScrollPane backGraundScrollPane = new JScrollPane();</span>
<span class="nc" id="L77">		backGraundScrollPane.setViewportView(backGraundPanel);</span>
		
<span class="nc" id="L79">		final JPanel reportContentPane = new JPanel();</span>
<span class="nc" id="L80">		reportContentPane.setLayout(new BorderLayout());</span>
<span class="nc" id="L81">		reportContentPane.add(topPanel, BorderLayout.NORTH);</span>
<span class="nc" id="L82">		topPanel.setLayout(new BorderLayout(0, 0));</span>
		
<span class="nc" id="L84">		final JPanel panel_2 = new JPanel();</span>
<span class="nc" id="L85">		topPanel.add(panel_2, BorderLayout.EAST);</span>
		
<span class="nc" id="L87">		final JButton printButton = new JButton();</span>
<span class="nc" id="L88">		panel_2.add(printButton);</span>
<span class="nc" id="L89">		printButton.setText(&quot;印刷&quot;);</span>
		
<span class="nc" id="L91">		final JButton exitButton = new JButton();</span>
<span class="nc" id="L92">		panel_2.add(exitButton);</span>
<span class="nc" id="L93">		exitButton.setText(&quot;閉じる&quot;);</span>
<span class="nc" id="L94">		label = new JLabel();</span>
<span class="nc" id="L95">		topPanel.add(label, BorderLayout.WEST);</span>
<span class="nc" id="L96">		label.setAlignmentX(Component.CENTER_ALIGNMENT);</span>
<span class="nc" id="L97">		label.setHorizontalAlignment(SwingConstants.CENTER);</span>
<span class="nc" id="L98">		label.setVerticalAlignment(SwingConstants.CENTER);</span>
<span class="nc" id="L99">		exitButton.addActionListener(new ActionListener() {</span>
			@Override
			public void actionPerformed(final ActionEvent e) {
<span class="nc" id="L102">				SwingUtilities.invokeLater(new Runnable() {</span>
					@Override
					public void run() {
<span class="nc" id="L105">						exit();</span>
<span class="nc" id="L106">					}</span>
				});
<span class="nc" id="L108">			}</span>
			
		});
<span class="nc" id="L111">		printButton.addActionListener(new ActionListener() {</span>
			@Override
			public void actionPerformed(final ActionEvent e) {
<span class="nc" id="L114">				SwingUtilities.invokeLater(new Runnable() {</span>
					@Override
					public void run() {
						try {
<span class="nc" id="L118">							writer.print();</span>
<span class="nc" id="L119">							exit();</span>
						}
<span class="nc" id="L121">						catch (final ReportException e1) {</span>
<span class="nc" id="L122">							JOptionPane.showMessageDialog(Preview.this, &quot;印刷に失敗しました&quot;);</span>
<span class="nc" id="L123">						}</span>
<span class="nc" id="L124">					}</span>
				});
<span class="nc" id="L126">			}</span>
		});
		
<span class="nc" id="L129">		reportContentPane.add(backGraundScrollPane, BorderLayout.CENTER);</span>
		
<span class="nc" id="L131">		this.setModal(true);</span>
<span class="nc" id="L132">		this.setSize(new Dimension(1024, 720));</span>
<span class="nc" id="L133">		this.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);</span>
<span class="nc" id="L134">		this.setTitle(&quot;印刷プレビュー&quot;);</span>
<span class="nc" id="L135">		this.setContentPane(reportContentPane);</span>
<span class="nc" id="L136">		final JPanel topPanelr = new JPanel();</span>
<span class="nc" id="L137">		reportContentPane.add(topPanelr, BorderLayout.SOUTH);</span>
<span class="nc" id="L138">		topPanelr.setLayout(new BorderLayout(0, 0));</span>
		
<span class="nc" id="L140">		final JPanel panel = new JPanel();</span>
<span class="nc" id="L141">		final FlowLayout flowLayout_2 = (FlowLayout) panel.getLayout();</span>
<span class="nc" id="L142">		flowLayout_2.setAlignment(FlowLayout.RIGHT);</span>
<span class="nc" id="L143">		topPanelr.add(panel);</span>
		
<span class="nc" id="L145">		final JSlider slider = new JSlider();</span>
<span class="nc" id="L146">		slider.setValue(10);</span>
<span class="nc" id="L147">		slider.setMinimum(1);</span>
<span class="nc" id="L148">		slider.setMaximum(100);</span>
<span class="nc" id="L149">		slider.setFocusable(false);</span>
<span class="nc" id="L150">		slider.addChangeListener(new ChangeListener() {</span>
			@Override
			public void stateChanged(final ChangeEvent e) {
<span class="nc" id="L153">				SwingUtilities.invokeLater(new Runnable() {</span>
					@Override
					public void run() {
<span class="nc" id="L156">						setScale(slider.getValue() / 10d);</span>
<span class="nc" id="L157">						centerPanel.revalidate();</span>
<span class="nc" id="L158">					}</span>
				});
<span class="nc" id="L160">			}</span>
		});
<span class="nc" id="L162">		panel.add(slider);</span>
		
<span class="nc" id="L164">		lblNewLabel = new JLabel();</span>
<span class="nc" id="L165">		panel.add(lblNewLabel);</span>
		
<span class="nc" id="L167">		previousButton = new JButton();</span>
<span class="nc" id="L168">		previousButton.setPreferredSize(new Dimension(30, 12));</span>
<span class="nc" id="L169">		previousButton.setMaximumSize(new Dimension(30, 12));</span>
<span class="nc" id="L170">		previousButton.setMinimumSize(new Dimension(30, 12));</span>
<span class="nc" id="L171">		previousButton.setMargin(new Insets(0, 0, 0, 0));</span>
<span class="nc" id="L172">		previousButton.setText(&quot;&lt;&quot;);</span>
<span class="nc" id="L173">		previousButton.setFocusable(false);</span>
<span class="nc" id="L174">		previousButton.addActionListener(new ActionListener() {</span>
			@Override
			public void actionPerformed(final ActionEvent e) {
<span class="nc" id="L177">				SwingUtilities.invokeLater(new Runnable() {</span>
					@Override
					public void run() {
<span class="nc" id="L180">						setPageIndex(pageIndex - 1);</span>
<span class="nc" id="L181">						refreshView();</span>
<span class="nc" id="L182">					}</span>
				});
<span class="nc" id="L184">			}</span>
		});
<span class="nc" id="L186">		reportContentPane.add(previousButton, BorderLayout.WEST);</span>
		
<span class="nc" id="L188">		nextButton = new JButton();</span>
<span class="nc" id="L189">		nextButton.setPreferredSize(new Dimension(30, 12));</span>
<span class="nc" id="L190">		nextButton.setMinimumSize(new Dimension(30, 12));</span>
<span class="nc" id="L191">		nextButton.setMaximumSize(new Dimension(30, 12));</span>
<span class="nc" id="L192">		nextButton.setMargin(new Insets(0, 0, 0, 0));</span>
<span class="nc" id="L193">		nextButton.setText(&quot;&gt;&quot;);</span>
<span class="nc" id="L194">		nextButton.setFocusable(false);</span>
<span class="nc" id="L195">		nextButton.addActionListener(new ActionListener() {</span>
			@Override
			public void actionPerformed(final ActionEvent e) {
<span class="nc" id="L198">				SwingUtilities.invokeLater(new Runnable() {</span>
					@Override
					public void run() {
<span class="nc" id="L201">						setPageIndex(pageIndex + 1);</span>
<span class="nc" id="L202">						refreshView();</span>
<span class="nc" id="L203">					}</span>
				});
<span class="nc" id="L205">			}</span>
		});
<span class="nc" id="L207">		reportContentPane.add(nextButton, BorderLayout.EAST);</span>
<span class="nc" id="L208">	}</span>
	
	void refreshView() {
<span class="nc bnc" id="L211" title="All 2 branches missed.">		this.previousButton.setEnabled((pageIndex &gt; 0));</span>
<span class="nc bnc" id="L212" title="All 2 branches missed.">		this.nextButton.setEnabled((pageIndex &lt; (this.writer.size() - 1)));</span>
<span class="nc" id="L213">		this.centerPanel.removeAll();</span>
<span class="nc" id="L214">		this.label.setText((pageIndex + 1) + &quot; / &quot; + this.writer.size());</span>
<span class="nc" id="L215">		this.centerPanel.setPreferredSize(new Dimension(writer.get(pageIndex).getWidth(), writer.get(pageIndex)</span>
		        .getHeight()));
<span class="nc" id="L217">		this.revalidate();</span>
<span class="nc" id="L218">		this.repaint();</span>
<span class="nc" id="L219">	}</span>
	
	void exit() {
<span class="nc" id="L222">		Preview.this.setVisible(false);</span>
<span class="nc" id="L223">		Preview.this.dispose();</span>
<span class="nc" id="L224">	}</span>
	
	private void setPageIndex(final int index) {
<span class="nc bnc" id="L227" title="All 2 branches missed.">		if (index &gt;= 0) {</span>
<span class="nc bnc" id="L228" title="All 2 branches missed.">			this.pageIndex = (index &gt; (this.writer.size() - 1) ? (this.writer.size() - 1) : index);</span>
		}
<span class="nc" id="L230">	}</span>
	
	private void setScale(final double scale) {
<span class="nc bnc" id="L233" title="All 2 branches missed.">		for (final Page page : this.writer) {</span>
<span class="nc" id="L234">			page.setScale(scale);</span>
<span class="nc" id="L235">		}</span>
<span class="nc" id="L236">		lblNewLabel.setText((int) (scale * 100) + &quot; %&quot;);</span>
<span class="nc" id="L237">		refreshView();</span>
<span class="nc" id="L238">	}</span>
	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.1.201405082137</span></div></body></html>